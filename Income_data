# Load required libraries
library(dplyr)
library(ggplot2)

# Set working directory and load the dataset
setwd("C:/Users/hp/Documents/R_Lab_Assignmnet")
income_data <- read.csv("Income_Data.csv")

# Calculate the number of rows and columns
num_rows <- nrow(income_data)
num_columns <- ncol(income_data)

# Print the result
cat("Number of Rows:", num_rows, "\n")
cat("Number of Columns:", num_columns, "\n")

# Convert specified variables to factor variables
income_data$state <- as.factor(income_data$state)
income_data$county <- as.factor(income_data$county)
income_data$county_FIPS <- as.factor(income_data$county_FIPS)

# Print the summary of the dataset
print(summary(income_data))

# Calculate summary statistics for numeric columns
numeric_cols <- income_data %>% select(where(is.numeric))
summary_stats <- numeric_cols %>% summarise_all(list(mean = mean, sd = sd), na.rm = TRUE)
print(summary_stats)

# Calculate population
income_data <- income_data %>%
  mutate(Population = (bachelor_degree_numbers_2020 / bachelor_degree_percentage_2020) * 100)

# Print summary of the "Population" column
cat("Summary of Population:\n")
print(summary(income_data$Population))

# Calculate the average percentage of individuals with a bachelor's degree by state
state_degrees <- income_data %>%
  group_by(state) %>%
  summarise(
    Total_Degree_Holders = sum(bachelor_degree_numbers_2020, na.rm = TRUE),
    Total_Population = sum(Population, na.rm = TRUE)
  ) %>%
  mutate(Average_Percentage = (Total_Degree_Holders / Total_Population) * 100) %>%
  arrange(desc(Average_Percentage))

# Print and plot the average percentage of individuals with a bachelor's degree by state
cat("Average Percentage of Bachelor's Degree Holders by State:\n")
print(state_degrees$Average_Percentage)
ggplot(state_degrees, aes(x = reorder(state, -Average_Percentage), y = Average_Percentage)) +
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(title = "Average Percentage of Bachelor's Degree Holders by State in 2020", x = "State", y = "Average Percentage")

# Plot the scatter plot with a scatter plot line
ggplot(income_data, aes(x = bachelor_degree_percentage_2020, y = per_capita_personal_income_2020)) +
  geom_point() +
  geom_smooth(method = "lm", formula = y ~ x, se = FALSE, color = "blue") +
  labs(title = "Scatter Plot of Per Capita Personal Income 2020 vs Bachelor's Degree Percentage 2020",
       x = "Bachelor's Degree Percentage 2020",
       y = "Per Capita Personal Income 2020") +
  theme_minimal()

# Calculate the total population for each state
top_10_states <- income_data %>%
  group_by(state) %>%
  summarise(Total_Population = sum(Population, na.rm = TRUE)) %>%
  arrange(desc(Total_Population)) %>%
  head(10)

# Filter data for only the top 10 states
top_counties_by_income <- income_data %>%
  filter(state %in% top_10_states$state) %>%
  group_by(state) %>%
  filter(per_capita_personal_income_2020 == max(per_capita_personal_income_2020)) %>%
  select(state, county, per_capita_personal_income_2020)

# Print the top counties by income
print(top_counties_by_income)
